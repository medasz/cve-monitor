package vulnerability

import (
	"github-cve/db"
	"time"
)

type Vulnerability struct {
	ID                      uint       `json:"id" gorm:"type:int not null auto_increment comment '记录ID'"`
	CVEID                   string     `json:"cveid" gorm:"type:varchar(30) not null comment 'CVE编号'"`
	VulnerabilityDetails    string     `json:"vulnerability_details" gorm:"type:text null comment '漏洞详情'"`
	Access                  string     `json:"access" gorm:"type:varchar(20) null comment '访问方式'"`
	VulnerabilityTypeSimple string     `json:"vulnerability_type_simple" gorm:"type:text null comment '漏洞类型简写'"`
	CVSSScore               string     `json:"cvss_score" gorm:"type:varchar(5) null comment 'CVSS分数'"`
	ConfidentialityImpact   string     `json:"confidentiality_impact" gorm:"type:text null comment '保密影响'"`
	IntegrityImpact         string     `json:"integrity_impact" gorm:"type:text null comment '诚信影响'"`
	AvailabilityImpact      string     `json:"availability_impact" gorm:"type:text null comment '可用性影响'"`
	AccessComplexity        string     `json:"access_complexity" gorm:"type:text null comment '访问复杂性'"`
	Authentication          string     `json:"authentication" gorm:"type text null comment '身份验证'"`
	GainedAccess            string     `json:"gained_access" gorm:"type:text null comment '获得访问权'"`
	VulnerabilityType       string     `json:"vulnerability_type" gorm:"type:text null comment '漏洞类型'"`
	CWEID                   string     `json:"cweid" gorm:"type:text null comment 'cwe编号'"`
	PublishDate             time.Time  `json:"publish_date" gorm:"type:date null comment '发布日期'"`
	LastUpdateDate          time.Time  `json:"last_update_date" gorm:"type:date null comment '最后更新时间'"`
	CreatedAt               *time.Time `json:"created_at" gorm:"type:timestamp not null default current_timestamp"`
	UpdatedAt               *time.Time `json:"updated_at" gorm:"type:timestamp null on update current_timestamp"`
}

func (receiver *Vulnerability) TableName() string {
	return "vulnerability"
}

func CreateTable() error {
	return db.DB.Set("gorm:table_options", "ENGINE=InnoDB comment '漏洞详情'").AutoMigrate(new(Vulnerability))
}
